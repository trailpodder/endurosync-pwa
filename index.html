<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>NUTS 300 Planner</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
  <style>
    #map { height: 300px; margin-bottom: 1rem; }
    #controls input { width: 60px; }
    body { font-family: sans-serif; padding: 1rem; max-width: 800px; margin: auto; }
    canvas { max-width: 100%; }
  </style>
</head>
<body>
  <h2>NUTS 300 Planner</h2>

  <div id="controls">
    <label>Goal Time (h): <input id="goalTime" type="number" value="96"/></label>
    <label>Rest Kalmankaltio (h): <input id="rest1" type="number" value="1"/></label>
    <label>Rest Hetta (h): <input id="rest2" type="number" value="2"/></label>
    <label>Rest Pallas (h): <input id="rest3" type="number" value="3"/></label>
    <button id="recalcBtn">Recalculate</button>
  </div>

  <div id="map"></div>
  <canvas id="paceChart"></canvas>

  <!-- Scripts -->
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>

  <!-- Minimal togeojson -->
  <script>
    this.togeojson = (function(){
      function attr(x) {
        const o = {};
        if (!x || !x.attributes) return o;
        for (let i = 0; i < x.attributes.length; i++) {
          const attr = x.attributes[i];
          o[attr.name] = attr.value;
        }
        return o;
      }
      function nodeVal(x) {
        if (!x || !x.firstChild) return '';
        return x.firstChild.nodeValue;
      }
      function get(x, tag) {
        return x.getElementsByTagName(tag);
      }
      function gpx(doc) {
        const tracks = get(doc, 'trk');
        const features = [];
        for (let i = 0; i < tracks.length; i++) {
          const trksegs = get(tracks[i], 'trkseg');
          for (let j = 0; j < trksegs.length; j++) {
            const trkpts = get(trksegs[j], 'trkpt');
            const coords = [];
            for (let k = 0; k < trkpts.length; k++) {
              const pt = trkpts[k];
              coords.push([
                parseFloat(pt.getAttribute('lon')),
                parseFloat(pt.getAttribute('lat')),
                parseFloat(get(pt, 'ele')[0]?.textContent || 0)
              ]);
            }
            features.push({
              type: 'Feature',
              properties: {},
              geometry: {
                type: 'LineString',
                coordinates: coords
              }
            });
          }
        }
        return {
          type: 'FeatureCollection',
          features: features
        };
      }
      return { gpx };
    })();
  </script>

  <script src="main.js"></script>
</body>
</html>
